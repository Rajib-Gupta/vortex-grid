<table>
  <thead>
    <tr>
      <th [attr.colspan]="columns.length" style="text-align: right; padding: 8px 0;">
        <!-- Toolbar buttons -->
        <ng-container *ngFor="let opt of toolbarOptions; let i = index">
          <button *ngIf="opt === 'save'"
            [ngStyle]="{background: toolbarBackgroundColor[0], color: toolbarTextColor[0]}"
            style="padding:8px 16px; border-radius:4px; border:1px solid #ffa000; font-weight:500; margin-right:8px;">
            Save Order
          </button>
          <button *ngIf="opt === 'reset'"
            [ngStyle]="{background: toolbarBackgroundColor[1], color: toolbarTextColor[1]}"
            style="padding:8px 16px; border-radius:4px; border:1px solid #616161; font-weight:500; margin-right:8px;">
            Reset Order
          </button>
          <button *ngIf="opt === 'export'"
            [ngStyle]="{background: toolbarBackgroundColor[2], color: toolbarTextColor[2]}"
            style="padding:8px 16px; border-radius:4px; border:1px solid #1976d2; font-weight:500; margin-right:8px;">
            Export CSV
          </button>
        </ng-container>
      </th>
    </tr>
    <tr>
      <th *ngFor="let col of columns; let colIdx = index"
          (click)="col.sortable && handleSort(col.field)"
          [style.cursor]="enableDragDrop ? 'move' : 'default'"
          [style.background]="draggedColIdx === colIdx ? '#e3f2fd' : undefined"
          [style.userSelect]="'none'">
        {{col.headerName}}
        <span *ngIf="col.sortable" [style.marginLeft.px]="6" [style.opacity]="sort?.field === col.field ? 1 : 0.4">
          {{ sort?.field === col.field ? (sort?.direction === 'asc' ? '↑' : '↓') : '↕' }}
        </span>
      </th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let row of pagedData; let idx = index"
        (click)="onRowClick(row, idx)"
        [style.cursor]="enableDragDrop ? 'move' : 'pointer'"
        [style.background]="selectedRowIdx === idx ? selectedRowIdxColor : undefined">
      <td *ngFor="let col of columns" [style.cursor]="'move'">
        {{row[col.field]}}
      </td>
    </tr>
  </tbody>
  <tfoot *ngIf="pagination">
    <tr>
      <td [attr.colspan]="columns.length" style="text-align:center; padding:16px 0;">
        <div style="display:inline-flex; align-items:center; gap:8px;">
          <button [disabled]="isFirstPage()"
            (click)="setPage(page - 1)"
            [ngStyle]="{
              padding: paginationSize === 'lg' ? '10px 20px' : paginationSize === 'sm' ? '4px 8px' : '7px 14px',
              borderRadius: paginationShape === 'pill' ? '999px' : '4px',
              border: '1px solid ' + paginationColor,
              background: !isFirstPage() ? paginationColor : '#e0e0e0',
              color: !isFirstPage() ? '#fff' : '#888',
              fontWeight: 500
            }"
            aria-label="Previous page">
            &#8592; Prev
          </button>
          <ng-container *ngFor="let p of getPagesArray(); let i = index">
            <button (click)="setPage(p)"
              [ngStyle]="{
                padding: paginationSize === 'lg' ? '10px 20px' : paginationSize === 'sm' ? '4px 8px' : '7px 14px',
                borderRadius: paginationShape === 'pill' ? '999px' : '4px',
                border: page === p ? '2px solid ' + paginationColor : '1px solid #bdbdbd',
                background: page === p ? paginationColor : '#fff',
                color: page === p ? '#fff' : '#333',
                fontWeight: page === p ? 700 : 500,
                margin: '0 2px',
                cursor: 'pointer'
              }"
              [attr.aria-current]="page === p ? 'page' : undefined">
              {{p}}
            </button>
          </ng-container>
          <button [disabled]="isLastPage()"
            (click)="setPage(page + 1)"
            [ngStyle]="{
              padding: paginationSize === 'lg' ? '10px 20px' : paginationSize === 'sm' ? '4px 8px' : '7px 14px',
              borderRadius: paginationShape === 'pill' ? '999px' : '4px',
              border: '1px solid ' + paginationColor,
              background: !isLastPage() ? paginationColor : '#e0e0e0',
              color: !isLastPage() ? '#fff' : '#888',
              fontWeight: 500
            }"
            aria-label="Next page">
            Next &#8594;
          </button>
        </div>
      </td>
    </tr>
  </tfoot>
</table>